# S10-INFRA overview

## Purpose
Single repo to bootstrap and operate a 3-node stack:
- **server1**: ClickHouse node + Keeper
- **server2**: Swarm manager, deploys stacks, hosts replicated CH table
- **server3**: Swarm worker running services

## Repo map
- `envs/` – environment files (`dev.env` and per-role overrides in `envs/<role>/dev.env`)
- `ops/` – bootstrap/ops scripts (e.g., `seed_env.sh`, bootstrap wrappers)
- `kafka/` – Kafka/Connect deployment scripts/configs
- `monitoring/` – Prometheus/Grafana configs/stacks
- `tools/smoke/` – non-destructive health checks
- `validation/` – helper tooling (venv, linters)
- `AGENTS.md` – operator notes and quick recipes
- `Makefile` – one-liners for render/deploy/smoke

## Env layering
At runtime we load in this order:
1. `/etc/sharpe10/dev.env` (generated by `make seed ROLE=<serverX>`)
2. `envs/dev.env` (base defaults)
3. `envs/<role>/dev.env` (role overrides)

## Quickstart (dev or fresh host)
```bash
make help
make dev-env
make seed ROLE=server2           # writes /etc/sharpe10/dev.env
make swarm-init                  # server2 only
make render                      # prepare config (if templates exist)
make deploy-monitor              # example stack deploy (server2)
make smoke ENV_NAME=dev ROLE=server2 SMOKE_MODE=live   # live checks
